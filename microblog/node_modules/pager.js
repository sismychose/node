function Pager(req) {
  this.showpage = "";
  this.req = req;
};
module.exports = Pager;

Pager.show_page = function show_page(req,page,pagelistnum,total,style,url,callback) {
  var totalpage,uppage,nextpage,tabletr,tabletd,nav,dmpage,thispage,mid,begin,end;
  page==''?page=1:'';//如果page为空则为1,否则为空
  totalpage = Math.ceil(total/pagelistnum);
  page > 1 ? uppage = parseInt(page) - 1 : uppage = 1;
  page >= totalpage ? nextpage = totalpage : nextpage = parseInt(page) + 1;
  tabletr = "<table width='100%' border='0' cellspacing='0' cellpadding='0'><tr><td height=20>";
  tabletd = "</td></tr></table>";
  nav = "&nbsp;&nbsp;";
  uppage = parseInt(page) - 1; //上一页
  dmpage = parseInt(page) + 1; //下一页
  //如果$url使用默认，即空值，则赋值为本页URL：
  if (!url) {
        url = req.originalUrl;
   }
   //URL分析：
   thispage = (url.indexOf('?page') != -1) ? '?page' : '&page';
   url = url.replace(thispage + "=" +page, '');
   //Url里有"?"就加"&"没有就加"?" 
   if (url.indexOf('?') != -1) {
       url+="&page";
   }else{
       url+="?page";
   }
   //console.log('style'+style);
   switch(style){
       case '1':
           //console.log('nav1');
           nav +="&nbsp;总计<B>"+total+"</B>条. 当前<B>"+page/totalpage+"</b>. ";
           if (page > 1) {
                nav += '<a href="' + url + '=' + uppage + '" class="page_linked">上一页</a> ';
            } else {
                nav += '';
            }
            mid = Math.ceil((pagelistnum + 1) / 2);
            if (page <= mid) {
                begin = 1;
            } else if (page > totalpage - mid) {
                begin = totalpage - pagelistnum + 1;
            } else {
                begin = page - mid + 1;
            }
            if (begin < 0)
                    begin = 1;
            end = (begin + pagelistnum > totalpage) ? totalpage + 1 : begin + pagelistnum;
            for (var i = begin; i < end; i++) {
                nav +=(page != i) ? " <a href='"+url+"="+i+"' title='The {"+i+"} page'>["+i+"]</a> " : " <span style='font-size:12pt;'>"+i+"</span> ";
            }
            if (page < totalpage) {
                nav += '<a href="' + url + '=' + dmpage + '" class="page_linked">Next</a> ';
            } else {
                nav += '';
            }
            break;
        case '2':
            //console.log('nav2');
            //9首页 7前页 后页8 尾页:
            nav +="&nbsp;总计<B>"+total+"</B>条记录. 当前第<B>"+page+"</B>页，共<strong>"+totalpage+"</strong>页. ";
            if (page > 1) {
                nav += '<a href="' + url + '=1" class="page_linked">首页</a> ';
                nav += '<a href="' + url + '=' + uppage + '" class="page_linked">上页</a> ';
            } else {
                nav += '<span class="page_unlink">首页</span> ';
                nav += '<span class="page_unlink">上页</span> ';
            }
            if (page < totalpage) {
                nav += '<a href="' + url + '=' + dmpage + '" class="page_linked">下页</a> ';
                nav += '<a href="' + url + '=' + totalpage + '" class="page_linked">尾页</a>';
            } else {
                nav += '<span class="page_unlink">下页</span> ';
                nav += '<span class="page_unlink">尾页</span>';
            }
            //下拉跳转列表，循环列出所有页码：
            nav +="　转到第 <select name='topage' size='1' onchange='window.location=\""+url+"=\"+this.value'>\n";
            for (var i = 1; i <= totalpage; i++) {
                if (i == page)
                    nav +="<option value='"+i+"' selected>"+i+"</option>\n";
                else
                    nav+="<option value='"+i+"'>"+i+"</option>\n";
            }
            nav +="</select> 页";
            break;
   }
   this.showpage = tabletr + nav + tabletd;
   //return this.showpage;
   callback(this.showpage);
};